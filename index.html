<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Faceit CS2 Dashboard</title>
<style>
  body { font-family: 'Orbitron', sans-serif; background:#0a0a0f; color:#fff; display:flex; flex-direction:column; align-items:center; padding:20px;}
  .player-card { background:rgba(10,10,15,0.95); border:2px solid #00ffff; border-radius:15px; padding:15px; margin:10px; width:400px; box-shadow:0 0 20px #00ffff;}
  h2 { color:#00ffff; text-shadow:0 0 10px #00ffff; }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  th, td { border:1px solid #00ffff; padding:5px; text-align:center; }
  th { background:#4B4B4B; }
  .good { background:#C0FFC0; }
  .bad { background:#FFC0C0; }
</style>
</head>
<body>
<h1>Faceit CS2 Dashboard</h1>
<div id="dashboard"></div>

<script>
const API_KEY = "dc63f5ce-1360-4c87-882a-c3c988115063";
const PLAYERS = ["-boZZo", "hey666", "SprinT-", "maxy0y0", "KatzRead"];
const GAME = "cs2";
const HEDEF = 5;

// Yardımcı fonksiyon: fetch JSON
async function fetchJSON(url) {
  const res = await fetch(url, { headers: { Authorization: "Bearer " + API_KEY } });
  return await res.json();
}

// Oyuncu ID'lerini al
async function getPlayerIds() {
  const ids = {};
  for(const player of PLAYERS){
    try{
      const data = await fetchJSON(`https://open.faceit.com/data/v4/players?nickname=${player}&game=${GAME}`);
      ids[player] = data.player_id;
    }catch(e){ ids[player] = null; }
  }
  return ids;
}

// Son 5 maç ve avg istatistikleri
async function getPlayerStats(player, playerId){
  if(!playerId) return null;

  const statsData = await fetchJSON(`https://open.faceit.com/data/v4/players/${playerId}/stats/${GAME}`);
  const lifetimeMatches = statsData.lifetime?.Matches || 0;

  const historyData = await fetchJSON(`https://open.faceit.com/data/v4/players/${playerId}/history?game=${GAME}&limit=5`);
  const matches = historyData.items || [];

  const recent = [];
  for(const match of matches){
    try{
      const matchData = await fetchJSON(`https://open.faceit.com/data/v4/matches/${match.match_id}/stats`);
      let kills=0, deaths=0;
      matchData.rounds.forEach(r=>{
        r.teams.forEach(t=>{
          t.players.forEach(p=>{
            if(p.nickname===player){
              kills += Number(p.player_stats.Kills||0);
              deaths += Number(p.player_stats.Deaths||0);
            }
          });
        });
      });
      const KD = deaths>0 ? (kills/deaths).toFixed(2) : kills;
      recent.push({result:match.matchStats?.Winner?"W":"L", kills, deaths, KD});
    }catch(e){ recent.push({result:"N/A", kills:"-", deaths:"-", KD:"-"}); }
  }

  return {matches:lifetimeMatches, recent};
}

// Dashboard oluştur
async function loadDashboard(){
  const playerIds = await getPlayerIds();
  const dashboard = document.getElementById("dashboard");

  for(const player of PLAYERS){
    const playerId = playerIds[player];
    const stats = await getPlayerStats(player, playerId);

    const card = document.createElement("div");
    card.className = "player-card";
    card.innerHTML = `<h2>${player}</h2>
      <p>Toplam Maç: ${stats?.matches||"N/A"}</p>
      <table>
        <tr><th>Son 5 Maç</th><th>Kills</th><th>Deaths</th><th>K/D</th></tr>
        ${stats?.recent.map(m=>`<tr>
          <td class="${m.result==="W"?"good":m.result==="L"?"bad":""}">${m.result}</td>
          <td>${m.kills}</td>
          <td>${m.deaths}</td>
          <td>${m.KD}</td>
        </tr>`).join("")}
      </table>`;
    dashboard.appendChild(card);
  }
}

loadDashboard();
</script>
</body>
</html>
